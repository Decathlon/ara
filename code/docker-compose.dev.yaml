version: "3"

services:
  ara-api:
    image: maven:3-adoptopenjdk-16
    working_dir: /app
    volumes:
      - ./api:/app
      - m2_home:/root/.m2
      - "${CONF_PATH:-../../ara-conf}/oauth-clientcredentials.yml:/config/config-custom.yaml:ro"
    command: ['/bin/bash', '-c', 'mvn -Pdev ${OPTIONAL_CLEAN} install && mvn -Pdev spring-boot:run -pl api']
#    ports:
#      - 8080:8080
  ara-web-ui:
    image: node:12
    working_dir: /app
    volumes:
      - ./web-ui:/app
    command: ['/bin/bash','-c','npm install && npm run start']
#    ports:
#      - 8081:8080
  ara-gw:
    image: maven:3-adoptopenjdk-16
    working_dir: /app
    volumes:
      - ./gateway:/app
      - m2_home:/root/.m2
      - "${CONF_PATH:-../../ara-conf}:/config:ro"
    ports:
      - 8080:8080
    environment:
      #  By default dev profile is active (through -Pdev), you can customize them if you wish
      #- SPRING_PROFILES_ACTIVE=none
      - SPRING_CONFIG_IMPORT=file:/config/oauth-clientcredentials.yml,file:/config/oauth-authorizationcode.yml
    command: ['/bin/bash', '-c', 'mvn -Pdev ${OPTIONAL_CLEAN} install && mvn spring-boot:run -X -Pdev']


volumes: 
  m2_home:
